<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=1920, height=1080">
  <title>Табло</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    html, body {
      width: 1920px;
      height: 1080px;
      overflow: hidden;
      background: transparent;
      font-family: "Segoe UI", "Arial Narrow", Arial, sans-serif;
      color: #fff;
    }
    #scoreboard-panel {
      width: 336px;
      height: 96px;
      background: linear-gradient(165deg, rgba(30, 58, 95, 0.95) 0%, rgba(13, 33, 55, 0.95) 100%);
      border: 1px solid rgba(255,255,255,0.2);
      border-radius: 7px;
      overflow: hidden;
      box-shadow: 0 5px 24px rgba(0,0,0,0.4), inset 0 1px 0 rgba(255,255,255,0.06);
    }
    #scoreboard-panel .top-strip {
      height: 2px;
      background: linear-gradient(90deg, #3b82f6 0%, #2563eb 50%, #1d4ed8 100%);
      opacity: 0.95;
    }
    #scoreboard-panel .rows {
      display: flex;
      flex-direction: column;
      padding: 6px 10px 7px;
      gap: 1px;
    }
    #scoreboard-panel .row {
      display: flex;
      align-items: center;
      min-height: 38px;
      padding: 0 5px;
      border-radius: 4px;
    }
    #scoreboard-panel .row.team-a {
      border-left: 5px solid var(--team-a-color, #3498db);
      background: rgba(255,255,255,0.03);
    }
    #scoreboard-panel .row.team-b {
      border-left: 5px solid var(--team-b-color, #e74c3c);
    }
    /* Порядок: цвет (border-left) | название | подача | счёт по партиям | счёт в партии */
    #scoreboard-panel .team-name {
      flex: 1;
      font-size: 17px;
      font-weight: 700;
      letter-spacing: 0.08em;
      text-transform: uppercase;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
      text-shadow: 0 1px 2px rgba(0,0,0,0.3);
      min-width: 0;
    }
    #scoreboard-panel .serve-dot {
      width: 7px; height: 7px;
      border-radius: 50%;
      background: #fbbf24;
      margin-left: 7px;
      margin-right: 14px;
      flex-shrink: 0;
      visibility: hidden;
      box-shadow: 0 0 7px rgba(251,191,36,0.6);
    }
    #scoreboard-panel .serve-dot.visible { visibility: visible; }
    /* Счёт по партиям — как текст, желтый */
    #scoreboard-panel .sets-won {
      font-size: 22px;
      font-weight: 700;
      font-variant-numeric: tabular-nums;
      color: #fcd34d;
      flex-shrink: 0;
      margin-right: 17px;
      text-shadow: 0 1px 2px rgba(0,0,0,0.3);
    }
    /* Счёт в текущей партии — крупнее, белый */
    #scoreboard-panel .current-score {
      font-size: 26px;
      font-weight: 800;
      font-variant-numeric: tabular-nums;
      color: #fff;
      flex-shrink: 0;
      text-shadow: 0 1px 3px rgba(0,0,0,0.4);
    }
  </style>
  <style>
    /* Обёртка: панель + плашки справа от неё */
    #scoreboard-wrap {
      position: absolute;
      left: 36px;
      top: 36px;
    }
    /* Плашка СЕТБОЛ/МАТЧБОЛ — справа от панели, по высоте напротив строки команды */
    .setball-plaque {
      position: absolute;
      left: 346px; /* ширина панели 336 + 10px отступ */
      padding: 6px 14px;
      border: 1px solid rgba(255,255,255,0.4);
      border-radius: 5px;
      font-size: 17px;
      font-weight: 600;
      letter-spacing: 0.12em;
      text-transform: uppercase;
      background: rgba(13, 33, 55, 0.95);
      color: #fde047;
      display: none;
      transform: translateY(-50%);
      box-shadow: 0 2px 10px rgba(0,0,0,0.3);
      text-shadow: 0 1px 2px rgba(0,0,0,0.5);
      line-height: 1.2;
    }
    .setball-plaque.visible { display: inline-block; }
    /* Центры строк (×1.2): top-strip 2 + padding 6 + row 38/2 = 28px; вторая строка 2+6+38+1+19 = 67px */
    #sb-setball-a.setball-plaque { top: 28px; }
    #sb-setball-b.setball-plaque { top: 67px; }
  </style>
</head>
<body>
  <div id="scoreboard-wrap">
    <div id="scoreboard-panel">
      <div class="top-strip"></div>
      <div class="rows">
        <div class="row team-a">
          <span class="team-name" id="sb-team-a"></span>
          <span class="serve-dot" id="sb-serve-a"></span>
          <span class="sets-won" id="sb-sets-a">0</span>
          <span class="current-score" id="sb-score-a">0</span>
        </div>
        <div class="row team-b">
          <span class="team-name" id="sb-team-b"></span>
          <span class="serve-dot" id="sb-serve-b"></span>
          <span class="sets-won" id="sb-sets-b">0</span>
          <span class="current-score" id="sb-score-b">0</span>
        </div>
      </div>
    </div>
    <span class="setball-plaque" id="sb-setball-a"></span>
    <span class="setball-plaque" id="sb-setball-b"></span>
  </div>
  <script>
    function safeText(el, text) {
      if (!el) return;
      el.textContent = text == null || text === '' ? '' : String(text);
    }
    function fetchData() {
      return fetch('/api/overlay/match').then(function(r) { return r.json(); });
    }
    var pollInterval = 1000;

    function renderScoreboard(data) {
      if (!data) return;
      var panel = document.getElementById('scoreboard-panel');
      if (panel && data.teamA && data.teamB) {
        panel.style.setProperty('--team-a-color', data.teamA.color);
        panel.style.setProperty('--team-b-color', data.teamB.color);
      }
      safeText(document.getElementById('sb-team-a'), data.teamA && data.teamA.name);
      safeText(document.getElementById('sb-team-b'), data.teamB && data.teamB.name);
      var cs = data.currentSet || {};
      safeText(document.getElementById('sb-score-a'), cs.scoreA);
      safeText(document.getElementById('sb-score-b'), cs.scoreB);
      var setsA = (data.sets || []).filter(function(s){ return s.status === 'completed' && s.scoreA > s.scoreB; }).length;
      var setsB = (data.sets || []).filter(function(s){ return s.status === 'completed' && s.scoreB > s.scoreA; }).length;
      safeText(document.getElementById('sb-sets-a'), setsA);
      safeText(document.getElementById('sb-sets-b'), setsB);
      var serveA = document.getElementById('sb-serve-a');
      var serveB = document.getElementById('sb-serve-b');
      if (serveA) serveA.classList.toggle('visible', cs.servingTeam === 'A');
      if (serveB) serveB.classList.toggle('visible', cs.servingTeam === 'B');
      var blockA = document.getElementById('sb-setball-a');
      var blockB = document.getElementById('sb-setball-b');
      var label = data.matchballTeam ? 'МАТЧБОЛ' : (data.setballTeam ? 'СЕТБОЛ' : '');
      var team = data.matchballTeam || data.setballTeam || null;
      if (blockA) {
        if (team === 'A') { blockA.textContent = label; blockA.classList.add('visible'); }
        else { blockA.classList.remove('visible'); }
      }
      if (blockB) {
        if (team === 'B') { blockB.textContent = label; blockB.classList.add('visible'); }
        else { blockB.classList.remove('visible'); }
      }
    }

    (function() {
      function tick() {
        fetchData().then(function(data) { renderScoreboard(data); }).catch(function() {});
      }
      tick();
      setInterval(tick, pollInterval);
    })();
  </script>
</body>
</html>
