# Текст коммита

```
fix: исправлена передача данных для полей либеро и добавлено форматирование времени партии

Исправлено:
- Проблема с текстовыми полями либеро (номер, имя, номер на карте): теперь всегда отправляются значения в vMix, даже если либеро не указан (пустые строки для очистки вывода)
- Логика установки цвета подложек либеро: каждое поле подложки проверяет свой конкретный либеро
  - Если конкретный либеро указан: устанавливается цвет из настроек (team.liberoColor или team.color)
  - Если конкретный либеро не указан: устанавливается прозрачный цвет #00000000
- Логика установки контрастного цвета текста для номеров либеро: цвет устанавливается только если конкретный либеро указан

Улучшено:
- Форматирование времени партии в инпутах "Счет после X партии": теперь отображается с символом "'" (например, "23'")
  - Использована функция formatDuration из timeUtils.js для единообразия с основной страницей

Технические детали:

1. Исправление логики для полей либеро:
   - Текстовые поля (libero1Number, libero1Name, libero1NumberOnCard, libero2Number, libero2Name, libero2NumberOnCard):
     * Всегда отправляются значения в vMix, даже если либеро не указан (пустые строки)
     * Это необходимо для очистки вывода в vMix при удалении либеро из состава
   - Подложки либеро (libero1Background, libero1BackgroundOnCard, libero2Background, libero2BackgroundOnCard):
     * Каждое поле проверяет свой конкретный либеро (libero1Background проверяет Либеро 1, libero2Background проверяет Либеро 2)
     * Если конкретный либеро указан: устанавливается цвет из настроек
     * Если конкретный либеро не указан: устанавливается прозрачный цвет
   - Цвет текста номеров либеро:
     * Проверяется конкретный либеро для каждого поля
     * Если конкретный либеро указан: устанавливается контрастный цвет
     * Если конкретный либеро не указан: цвет не устанавливается

2. Форматирование времени партии:
   - В функции getSetScoreFieldValue для поля Duration используется formatDuration вместо String
   - Время партии теперь отображается как "23'" вместо "23"
   - Обеспечивает единообразие с отображением на основной странице

3. Обновление документации:
   - Обновлена логика работы в libero-background-fields-plan.md
   - Обновлено описание обработки полей либеро в ARCHITECTURE.md
   - Обновлено описание форматирования времени в set-score-inputs-implementation-guide.md
   - Обновлен CHANGELOG.md

Затронутые файлы:
- src/renderer/hooks/useVMix.js - исправлена логика formatStartingLineupData и getSetScoreFieldValue
- docs/development/libero-background-fields-plan.md - обновлена документация логики
- docs/architecture/ARCHITECTURE.md - обновлено описание обработки полей либеро
- docs/development/set-score-inputs-implementation-guide.md - обновлено описание форматирования времени
- CHANGELOG.md - добавлены записи об исправлениях
- COMMIT_MESSAGE.md - обновлен текст коммита

---

Предыдущий коммит:

feat: завершен рефакторинг управления счетом и состояниями партий (Этап 9)

Завершено:
- Все 9 этапов рефакторинга успешно завершены
- Исправлены все ошибки в тестах и все тесты проходят успешно
- Завершено финальное тестирование (Этап 9)

Исправлено:
- Проблемы с импортами TypeScript в тестах (добавлены расширения .ts)
- Проблемы с моками Jest для работы с ESM модулями
- Проблемы с import.meta в тестах через Babel плагин
- Логика тестов useMatch для соответствия реальной реализации
- Импорты TypeScript файлов в компонентах (SetEditModal.jsx, SetsDisplay.jsx)
- Убраны проблемные моки из jest.config.js

Добавлено:
- Babel плагин babel-plugin-transform-import-meta для поддержки import.meta в тестах
- Обновлена документация: этап 9 помечен как завершенный

Технические детали:

1. Исправление импортов TypeScript:
   - Добавлены расширения .ts для всех импортов TypeScript файлов в тестах
   - Исправлены импорты в компонентах (SetEditModal.jsx, SetsDisplay.jsx)
   - Исправлены импорты в тестах (SetService.test.ts, HistoryService.test.ts, и др.)

2. Исправление моков Jest:
   - Использование переменных с префиксом mock для доступа внутри jest.mock()
   - Убраны проблемные моки Match.ts из jest.config.js
   - Исправлены моки для logoManager и других модулей

3. Исправление проблем с import.meta:
   - Установлен babel-plugin-transform-import-meta
   - Добавлен плагин в .babelrc для поддержки import.meta.url в тестах
   - Убрано использование createRequire(import.meta.url) где возможно

4. Исправление тестов useMatch:
   - Убраны ожидания вызовов ScoreService.changeScore и ScoreService.changeServingTeam
   - Исправлены тесты для проверки локальной истории вместо HistoryService
   - Исправлены тесты updateSet для соответствия реальной логике
   - Исправлены тесты undoLastAction для работы с локальной историей

5. Обновление документации:
   - Этап 9 помечен как завершенный в implementation-guide.md
   - Добавлено описание выполненных работ

Затронутые файлы:
- tests/unit/**/*.test.{js,ts} - исправлены импорты и моки
- src/renderer/components/SetEditModal.jsx - исправлены импорты
- src/renderer/components/SetsDisplay.jsx - исправлены импорты
- jest.config.js - убраны проблемные моки
- .babelrc - добавлен плагин для import.meta
- package.json - добавлен babel-plugin-transform-import-meta
- docs/development/score-and-set-status-refactoring-implementation-guide.md - обновлен статус
- CHANGELOG.md - добавлена информация о завершении этапа 9
- COMMIT_MESSAGE.md - обновлен текст коммита
```
