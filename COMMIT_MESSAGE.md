# Текст коммита

```
Добавлено поле "Цвет формы либеро" и автоматическое определение контрастного цвета текста

Основные изменения:

1. Добавлено поле "Цвет формы либеро" для команд:
   - Добавлено опциональное поле liberoColor в структуру Team (Match.ts и matchUtils.js)
   - На странице "Настройки матча" переименовано "Цвет формы" на "Цвет формы игроков"
   - Добавлено новое поле "Цвет формы либеро" ниже поля "Цвет формы игроков" для обеих команд
   - Поле сохраняется в структуре данных матча и готово к использованию в будущем
   - Функция смены команд местами автоматически меняет местами liberoColor вместе с остальными полями

2. Реализовано автоматическое определение контрастного цвета текста:
   - Создана утилита colorContrast.js для автоматического определения оптимального цвета текста на цветном фоне
   - Используется формула относительной яркости (relative luminance) из WCAG 2.1 для точного определения контрастности
   - Функция getContrastTextColor() возвращает черный (#000000) или белый (#ffffff) текст в зависимости от яркости фона
   - На странице "Управление матчем" цвет текста названий команд автоматически адаптируется к цвету фона
   - На странице "Управление составами" цвет текста кнопок выбора команды автоматически адаптируется к цвету фона
   - Решена проблема с нечитаемым текстом при белой или черной форме игроков

Предыдущие изменения:

1. Исправлена очистка логотипов при открытии проекта без логотипов:

1. Исправлена очистка логотипов при открытии проекта без логотипов:
   - При открытии проекта без логотипов файлы logo_a.png и logo_b.png от предыдущего проекта теперь удаляются
   - Функция processTeamLogoForLoad явно обнуляет поля логотипов (logo, logoPath, logoBase64) при их отсутствии в JSON
   - Функция processTeamLogoForSave удаляет файлы логотипов при сохранении проекта без логотипов
   - Добавлена функция clearLogosOnNewMatch() для удаления логотипов при создании нового матча
   - Исправлена ошибка с повторным объявлением fs и path в fileManager.js
   - Логотипы корректно обнуляются в интерфейсе при открытии пустого проекта
   - Старые логотипы не сохраняются в новый проект при автосохранении

2. Исправлена передача команд в vMix при открытии проекта:
   - При открытии проекта из файла команды на обновление инпутов теперь всегда отправляются, даже если поля пустые
   - Изменена проверка hasFields в функциях обновления: при forceUpdate=true команды отправляются всегда
   - Функция formatCurrentScoreData теперь отправляет все текстовые поля, включая пустые
   - Функции formatLineupData, formatRosterData, formatStartingLineupData отправляют пустые изображения при forceUpdate=true
   - Это позволяет очистить данные в vMix при открытии пустого проекта
   - vMix корректно синхронизируется с состоянием приложения при открытии проекта

Предыдущие изменения:

1. Исправлена передача логотипов в vMix через API команды:

1. Исправлена передача логотипов в vMix через API команды:
   - Исправлена проверка наличия логотипов: теперь проверяются logo, logoPath и logoBase64
   - Исправлено формирование URL для логотипов в getLineupFieldValue, getRosterFieldValue и getStartingLineupFieldValue
   - Исправлен двойной путь /logos/logos/ в функциях для составов команд
   - Исправлена функция processTeamLogoForSave: теперь проверяет и logo, и logoBase64
   - Логотипы теперь корректно передаются в vMix через команду SetImage во всех случаях

2. Исправлена работа логотипов в production режиме:
   - Логотипы теперь сохраняются в userData/logos/ вместо extraResources/logos/ (доступно для записи)
   - Добавлена автоматическая миграция логотипов из extraResources в userData при первом запуске в production
   - Сервер мобильного доступа обслуживает логотипы из userData/logos/ в production режиме
   - Исправлены пути к логотипам для корректной работы с Electron app.getPath('userData')
   - Добавлена обработка ошибок при определении путей в случае, если app еще не готов

3. Добавлен выбор сетевого интерфейса для мобильного сервера:
   - Добавлена функция getNetworkInterfaces() для получения списка всех доступных сетевых интерфейсов
   - Добавлен выпадающий список выбора сетевого интерфейса на странице "Мобильный доступ"
   - Выбранный сетевой интерфейс сохраняется в настройках мобильного сервера (mobile.selectedIP)
   - Мобильный сервер использует выбранный IP адрес вместо автоматического определения
   - Решена проблема, когда сервер запускался в другой подсети, чем vMix (например, 10.x.x.x vs 192.168.144.x)
   - Добавлены IPC handlers: mobile:get-network-interfaces и mobile:set-selected-ip
   - Выбор интерфейса блокируется при запущенном сервере (требуется перезапуск для применения изменений)
   - Обновлены инструкции на странице мобильного доступа с информацией о выборе интерфейса

Предыдущие изменения:

1. Исправлена работа приложения после компиляции:
   - Исправлены все пути к файлам для корректной работы с ASAR архивом в Electron
   - Обновлены пути к dist/index.html, preload.js, иконкам в main.js с использованием app.getAppPath()
   - Исправлены пути к logos и matches для использования process.resourcesPath в production
   - Обновлены функции getLogosDir() и getMatchesDir() для динамического определения путей
   - Все файлы теперь корректно находятся и загружаются в production режиме

2. Исправлена проблема с маршрутизацией в production:
   - Реализовано автоматическое переключение между BrowserRouter (dev) и HashRouter (production)
   - HashRouter используется при обнаружении file:// протокола
   - Добавлена нормализация начального пути при загрузке без хэша
   - Решена проблема "No routes matched location" при запуске скомпилированного приложения
   - В dev режиме сохраняется использование BrowserRouter для чистых URL

3. Настроена сборка Electron приложения:
   - Добавлена полная конфигурация electron-builder в package.json
   - Настроены пути для включения всех необходимых файлов и ресурсов
   - Исправлены ошибки конфигурации: deprecated directories, недопустимые свойства
   - Отключена подпись кода для Windows (signAndEditExecutable: false)
   - Добавлена переменная окружения CSC_IDENTITY_AUTO_DISCOVERY=false для предотвращения ошибок подписи
   - Установлен cross-env для кроссплатформенной установки переменных окружения
   - Решена проблема с символическими ссылками winCodeSign при сборке на Windows

4. Добавлены инструменты разработчика для production:
   - Горячая клавиша F12 для открытия/закрытия DevTools
   - Альтернативная комбинация Ctrl+Shift+I (Cmd+Shift+I на macOS)
   - Пункт меню "Вид" → "Инструменты разработчика"
   - DevTools теперь доступны для отладки в production режиме
   - Добавлено улучшенное логирование ошибок JavaScript

5. Автоматическое включение настроек в сборку:
   - settings.json из корня проекта автоматически включается в extraResources
   - При первом запуске настройки копируются из extraResources в userData
   - В production настройки читаются и сохраняются в пользовательской директории
   - В dev режиме настройки работают как раньше (из корня проекта)
   - Пользователь может изменять настройки, которые сохраняются между запусками

6. Обновлена видимость полей подачи при переключении команды:
   - Добавлен useEffect для отслеживания изменений servingTeam
   - При переключении подачи автоматически вызывается updateMatchData
   - Поля pointA и pointB обновляют свою видимость в vMix
   - Работает аналогично обновлению видимости при начислении очков

Технические детали:

- Пути к файлам в production определяются динамически через функции
- Используется process.resourcesPath для доступа к extraResources (вне ASAR)
- Используется app.getAppPath() для доступа к файлам внутри ASAR
- Используется app.getPath('userData') для хранения пользовательских настроек
- HashRouter использует хэш-навигацию (#/path), что работает с file:// протоколом
- DevTools регистрируются через globalShortcut и автоматически отменяются при выходе

Затронутые файлы:
- src/shared/types/Match.ts - добавлено опциональное поле liberoColor в интерфейс Team; обновлена функция createNewMatch для инициализации liberoColor: undefined
- src/shared/matchUtils.js - обновлена функция createNewMatch для инициализации liberoColor: undefined в командах
- src/renderer/pages/MatchSettingsPage.jsx - переименовано "Цвет формы" на "Цвет формы игроков"; добавлено поле "Цвет формы либеро" для обеих команд; добавлены поля teamALiberoColor и teamBLiberoColor в formData; обновлены функции загрузки и сохранения для работы с liberoColor; обновлена функция смены команд для сохранения liberoColor
- src/renderer/utils/colorContrast.js - создан новый файл с утилитами для работы с контрастностью цветов; функция getContrastTextColor() для автоматического определения оптимального цвета текста на основе формулы относительной яркости WCAG 2.1
- src/renderer/pages/MatchControlPage.jsx - добавлен импорт getContrastTextColor; заменен жестко заданный color: "white" на динамический color: getContrastTextColor() для обеих команд
- src/renderer/pages/RosterManagementPage.jsx - добавлен импорт getContrastTextColor; заменен жестко заданный color: 'white' на динамический color: getContrastTextColor() для кнопок выбора команды
- CHANGELOG.md - добавлена информация о новых функциях и исправлениях

Предыдущие изменения:

1. Исправлена очистка логотипов при открытии проекта без логотипов:
   - При открытии проекта без логотипов файлы logo_a.png и logo_b.png от предыдущего проекта теперь удаляются
   - Функция processTeamLogoForLoad явно обнуляет поля логотипов (logo, logoPath, logoBase64) при их отсутствии в JSON
   - Функция processTeamLogoForSave удаляет файлы логотипов при сохранении проекта без логотипов
   - Добавлена функция clearLogosOnNewMatch() для удаления логотипов при создании нового матча
   - Исправлена ошибка с повторным объявлением fs и path в fileManager.js
   - Логотипы корректно обнуляются в интерфейсе при открытии пустого проекта
   - Старые логотипы не сохраняются в новый проект при автосохранении

2. Исправлена передача команд в vMix при открытии проекта:
   - При открытии проекта из файла команды на обновление инпутов теперь всегда отправляются, даже если поля пустые
   - Изменена проверка hasFields в функциях обновления: при forceUpdate=true команды отправляются всегда
   - Функция formatCurrentScoreData теперь отправляет все текстовые поля, включая пустые
   - Функции formatLineupData, formatRosterData, formatStartingLineupData отправляют пустые изображения при forceUpdate=true
   - Это позволяет очистить данные в vMix при открытии пустого проекта
   - vMix корректно синхронизируется с состоянием приложения при открытии проекта

3. Исправлена передача логотипов в vMix через API команды:

Предыдущие изменения:

1. Добавлены поля "Номер на карте", переименованы либеро и улучшена миграция настроек:
   - Добавлены поля player1NumberOnCard - player6NumberOnCard для всех 6 основных игроков
   - Добавлены поля libero1NumberOnCard и libero2NumberOnCard для либеро
   - Поля player7/8 переименованы в libero1/2 для стартовых составов
   - Обновлена логика: либеро берутся из стартового состава (индексы 6 и 7)
   - Если специальный номер на карте не указан, автоматически используется обычный номер
   - Исправлена проблема с отображением вкладок стартовых составов в настройках vMix
   - Реализована автоматическая миграция и дополнение недостающих инпутов и полей

2. Реализована отправка данных стартовых составов в vMix:
   - Добавлены функции для автоматической отправки данных стартовых составов команд в vMix
   - Поддержка до 8 игроков в стартовом составе (6 основных + 2 либеро)
   - Автоматическое обновление стартовых составов при изменении данных матча
   - Кэширование отправленных значений для оптимизации

3. Исправлена реакция кнопок на активацию инпутов через vMix:
   - Кнопки теперь корректно отражают состояние инпутов независимо от способа активации
   - Добавлен механизм определения внешней активации через маркер '__EXTERNAL__'

4. Оптимизация отправки команд в vMix:
   - Реализована система отслеживания изменений полей для минимизации обращений к vMix API
   - Кэширование последних отправленных значений для каждого инпута
   - Отправка только измененных полей вместо всех полей при каждом обновлении
   - Значительное снижение нагрузки на vMix API и улучшение производительности

5. Исправление обновления логотипов при смене команд:
   - Добавлен timestamp к URL логотипов при принудительном обновлении
   - Добавлена функция cleanupLogosDirectory() для удаления устаревших файлов
   - Логотипы теперь корректно обновляются при смене команд
```
