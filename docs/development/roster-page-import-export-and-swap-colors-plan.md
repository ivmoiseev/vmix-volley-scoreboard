# История изменений: перенос Импорт/Экспорт и кнопка «Поменять цвета»

*Последнее обновление: 2026-02-16*

Документ описывает выполненные изменения на странице «Управление составами» и в общем компоненте выбора цветов формы. Изначально изменения были запланированы в виде рефакторинга; ниже — хронология внесённых правок.

---

## Исходные цели

1. Перенести кнопки «Импорт» и «Экспорт» в блок «Внешний вид команды» (импорт/экспорт относятся ко всем параметрам команды: название, город, логотип, цвета, состав, тренер).
2. Добавить кнопку «Поменять цвета» для обмена значений «Цвет формы игроков» и «Цвет формы либеро» (сценарий: два комплекта формы, в разных матчах команда и либеро меняют цвета местами).
3. Использовать единый компонент `TeamColorsEditor` на страницах «Управление составами» и «Настройки матча» без дублирования кода.

---

## История изменений

### 2026-02-16 — Перенос кнопок и кнопка «Поменять цвета»

**RosterManagementPage**

- Заголовок блока «Внешний вид команды» оформлен как flex-строка: слева заголовок, справа кнопки «Импорт» и «Экспорт». Обработчики `handleImportRoster` и `handleExportRoster` без изменений.
- В блоке «Состав команды» в строке с заголовком оставлена только кнопка «Добавить игрока»; кнопки «Импорт» и «Экспорт» удалены из этого блока.

**TeamColorsEditor**

- Добавлена кнопка «Поменять цвета» (компонент `Button`, `variant="secondary"`). По клику вызывается `onChange({ color: liberoColor || '', liberoColor: color || '' })`.
- Для кнопки задан `aria-label`: «Поменять местами цвет формы игроков и цвет формы либеро».
- Компонент используется на страницах «Управление составами» и «Настройки матча» — кнопка появилась на обеих без дополнительных правок.

**Документация и тесты**

- Обновлены `docs/getting-started/ui-structure.md` и `docs/development/roster-management-refactoring-plan.md` (описание расположения кнопок и кнопки «Поменять цвета»).
- В `RosterManagementPage.test.tsx` добавлены тесты: кнопки «Импорт» и «Экспорт» в блоке «Внешний вид команды»; в блоке «Состав команды» только «Добавить игрока».
- Создан `tests/unit/renderer/TeamColorsEditor.test.tsx`: отображение кнопки «Поменять цвета», вызов `onChange` с обменянными значениями, поведение при пустом `liberoColor`.

---

### 2026-02-16 — Корректная обработка пустого цвета (цвет не указан)

**Проблема**

- После нажатия «Поменять цвета» при пустом цвете либеро («Не указан») в поле «Цвет формы игроков» сохранялось пустое значение (`''`). В `input type="color"` передавалось `value=""`, что не соответствует формату HTML5 (`#rrggbb`).
- В консоли появлялись предупреждения: `The specified value "" does not conform to the required format. The format is "#rrggbb"`.
- Пикер цвета отображался некорректно (например, чёрный квадрат при пустом значении).

**Исправление в TeamColorsEditor**

- Введена константа `COLOR_PICKER_FALLBACK = '#ffffff'`. Для отображения пикера (но не для хранения значения) при пустом цвете используется fallback:
  - «Цвет формы игроков»: `value={color || COLOR_PICKER_FALLBACK}` у `input type="color"`.
  - «Цвет формы либеро»: `value={liberoColor || COLOR_PICKER_FALLBACK}` у `input type="color"` (раньше использовался литерал `'#ffffff'`, заменён на общую константу).
- Текстовое поле «Цвет формы игроков» при пустом значении показывает placeholder «Не указан» (как у либеро).
- Для обоих пикеров добавлены `aria-label` («Цвет формы игроков», «Цвет формы либеро») для доступности.

**Результат**

- Пустое значение по-прежнему хранится и передаётся в `onChange` как `''`; в пикер всегда передаётся валидный hex, предупреждения в консоли исчезают, отображение после обмена корректно.

---

## Связанные файлы

- `src/renderer/components/TeamColorsEditor.tsx` — редактор цветов, кнопка «Поменять цвета», обработка пустого цвета.
- `src/renderer/pages/RosterManagementPage.tsx` — расположение кнопок «Импорт», «Экспорт», «Добавить игрока».
- `docs/getting-started/ui-structure.md` — описание интерфейса страницы «Управление составами».
- `docs/development/roster-management-refactoring-plan.md` — общее описание рефакторинга страницы составов.
- `tests/unit/renderer/TeamColorsEditor.test.tsx`, `tests/unit/renderer/RosterManagementPage.test.tsx` — тесты.
