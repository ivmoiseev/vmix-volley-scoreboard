# План разработки приложения vMix Volley Scoreboard

## Этап 1: Инициализация проекта и базовая структура

### 1.1. Настройка проекта Electron

- [ ] Инициализация проекта (npm init)
- [ ] Установка Electron
- [ ] Установка React и необходимых зависимостей
- [ ] Настройка структуры папок проекта
- [ ] Создание базовой конфигурации Electron (main.js, preload.js)
- [ ] Настройка сборки проекта (webpack/vite или другой бандлер)

### 1.2. Базовая структура приложения

- [ ] Создание главного окна Electron
- [ ] Настройка React приложения
- [ ] Создание базовой маршрутизации (React Router)
- [ ] Настройка IPC коммуникации между процессами
- [ ] Создание базовых компонентов (Layout, Header, Navigation)

**Результат:** Работающее Electron приложение с базовым React интерфейсом

---

## Этап 2: Модель данных и управление файлами

### 2.1. Модель данных матча

- [ ] Определение структуры JSON файла матча
- [ ] Создание TypeScript интерфейсов/типов для данных матча
- [ ] Создание утилит для валидации данных

**Структура JSON файла матча:**

```json
{
  "matchId": "uuid",
  "tournament": "string",
  "venue": "string",
  "date": "ISO date",
  "time": "ISO time",
  "teamA": {
    "name": "string",
    "color": "hex color",
    "logo": "base64 или путь к файлу",
    "coach": "string",
    "roster": [
      {
        "number": 1,
        "name": "string",
        "position": "string",
        "isStarter": true
      }
    ]
  },
  "teamB": {
    "name": "string",
    "color": "hex color",
    "logo": "base64 или путь к файлу",
    "coach": "string",
    "roster": [
      {
        "number": 1,
        "name": "string",
        "position": "string",
        "isStarter": true
      }
    ]
  },
  "officials": {
    "referee1": "string",
    "referee2": "string",
    "lineJudge1": "string",
    "lineJudge2": "string",
    "scorer": "string"
  },
  "sets": [
    {
      "setNumber": 1,
      "scoreA": 25,
      "scoreB": 20,
      "completed": true
    }
  ],
  "currentSet": {
    "setNumber": 2,
    "scoreA": 15,
    "scoreB": 18,
    "servingTeam": "A"
  },
  "statistics": {
    "enabled": false,
    "teamA": {
      "attack": 0,
      "block": 0,
      "serve": 0,
      "opponentErrors": 0
    },
    "teamB": {
      "attack": 0,
      "block": 0,
      "serve": 0,
      "opponentErrors": 0
    }
  },
  "createdAt": "ISO datetime",
  "updatedAt": "ISO datetime"
}
```

### 2.2. Управление файлами

- [ ] Реализация функции создания нового матча
- [ ] Реализация функции открытия матча (диалог выбора файла)
- [ ] Реализация функции сохранения матча
- [ ] Реализация функции "Сохранить как..."
- [ ] Обработка ошибок при работе с файлами
- [ ] IPC handlers для работы с файлами

**Результат:** Возможность создавать, открывать и сохранять матчи в JSON формате

---

## Этап 3: Основной интерфейс управления матчем

### 3.1. Страница управления матчем

- [ ] Компонент отображения информации о матче
- [ ] Компонент отображения команд
- [ ] Компонент отображения счета по партиям
- [ ] Компонент управления текущим счетом
- [ ] Кнопки управления (+1, -1 для каждой команды)
- [ ] Компонент отображения текущей подачи
- [ ] Кнопки ручной коррекции подачи (◄ ►)
- [ ] Индикаторы сетбола и матчбола
- [ ] Кнопка завершения партии
- [ ] Функция отмены последнего действия (история действий)
- [ ] Валидация правил волейбола (до 25 очков, разница минимум 2 и т.д.)
- [ ] Переключатель расширенной статистики
- [ ] Кнопки управления статистикой (Атака, Блок, Подачи, Ошибки соперника)
- [ ] Кнопки управления плашками vMix (12 различных плашек)

### 3.2. Логика ведения счета

- [ ] Управление счетом текущей партии
- [ ] Автоматический учет перехода подачи при начислении очка
- [ ] Логика ручной коррекции подачи
- [ ] Определение сетбола (по правилам ВФВ)
- [ ] Определение матчбола (по правилам ВФВ)
- [ ] Логика завершения партии
- [ ] Переход к следующей партии
- [ ] Определение победителя матча
- [ ] История действий для отмены

### 3.3. Расширенная статистика

- [ ] Модель данных для статистики
- [ ] Компоненты для ввода статистики
- [ ] Подсчет статистики по категориям (Атака, Блок, Подачи, Ошибки соперника)
- [ ] Отображение статистики в интерфейсе
- [ ] Интеграция статистики с плашками vMix
- [ ] Валидация опциональности (не блокирует основное ведение счета)

**Результат:** Полнофункциональная страница управления матчем с логикой ведения счета

---

## Этап 4: Настройки матча

### 4.1. Страница настроек матча

- [ ] Форма для ввода информации о турнире
- [ ] Форма для настройки команд (названия, цвета)
- [ ] Компонент выбора цвета (цветовой пикер)
- [ ] Компонент выбора даты и времени
- [ ] Форма для указания судейской коллегии
- [ ] Валидация форм
- [ ] Сохранение изменений в текущий матч

### 4.2. Управление составами команд

- [ ] Страница управления составами команд
- [ ] Компонент загрузки логотипов команд
- [ ] Форма для указания тренеров команд
- [ ] Редактор состава команды (добавление, удаление игроков)
- [ ] Указание позиций игроков
- [ ] Выбор стартового состава
- [ ] Импорт/экспорт составов в файлы
- [ ] Сохранение составов в файл матча

**Результат:** Страница для настройки всех параметров матча и управления составами команд

---

## Этап 5: Интеграция с vMix

### 5.1. HTTP клиент для vMix

- [ ] Изучение vMix HTTP API
- [ ] Создание модуля для отправки HTTP запросов к vMix
- [ ] Функции для обновления инпутов
- [ ] Функции для управления оверлеями
- [ ] Обработка ошибок подключения
- [ ] Тестирование подключения

### 5.2. Страница настроек vMix

- [ ] Форма для ввода IP адреса и порта
- [ ] Кнопка тестирования подключения
- [ ] Форма для настройки названий инпутов (12 инпутов для всех плашек)
- [ ] Выбор оверлея (радио-кнопки)
- [ ] Сохранение настроек в конфигурационный файл

### 5.3. Автоматическое обновление vMix

- [ ] Подписка на изменения счета
- [ ] Автоматическая отправка обновлений в vMix при изменении счета
- [ ] Обновление всех настроенных инпутов
- [ ] Индикатор статуса подключения

### 5.4. Управление плашками vMix

- [ ] Функции для вывода плашек в оверлеи через HTTP API vMix
- [ ] Кнопки управления плашками в интерфейсе:
  - Заявка (TeamA vs TeamB)
  - Статистика
  - Состав команды (полный)
  - Стартовый состав команды
  - Текущий счет (во время партии)
  - Счет после 1-5 партий
  - Плашка 1 судья
  - Плашка 2 судьи
- [ ] Подготовка данных для каждой плашки
- [ ] Отправка данных в соответствующие инпуты vMix
- [ ] Управление оверлеями (показ/скрытие плашек)
- [ ] Реализация state-dependent кнопок плашек
- [ ] Запрос текущего состояния оверлеев из vMix через HTTP API
- [ ] Синхронизация состояния кнопок с реальным состоянием оверлеев в vMix
- [ ] Визуальная индикация активного/неактивного состояния плашек
- [ ] Обновление состояния кнопок при изменении состояния оверлеев в vMix
- [ ] Обработка случая отсутствия соединения с vMix (кнопки неактивны или показывают неизвестное состояние)

**Результат:** Полная интеграция с vMix с автоматическим обновлением данных

---

## Этап 6: Встроенный HTTP сервер

### 6.1. Создание HTTP сервера

- [ ] Настройка Express или встроенного Node.js HTTP сервера
- [ ] Определение порта для сервера
- [ ] Получение локального IP адреса
- [ ] Запуск/остановка сервера
- [ ] Обработка CORS для мобильных устройств

### 6.2. Система доступа

- [ ] Генерация уникальных идентификаторов для сессий
- [ ] Хранение активных сессий
- [ ] Валидация доступа по уникальной ссылке
- [ ] Истечение срока действия ссылок (опционально)

### 6.3. API endpoints

- [ ] `GET /panel/:sessionId` - страница мобильной панели
- [ ] `GET /api/match/:sessionId` - получение данных матча
- [ ] `POST /api/match/:sessionId/score` - обновление счета
- [ ] `POST /api/match/:sessionId/set` - завершение партии
- [ ] WebSocket или Server-Sent Events для real-time обновлений (опционально)

**Результат:** Работающий HTTP сервер с системой безопасного доступа

---

## Этап 7: Страница мобильного доступа

### 7.1. Генерация ссылок и QR-кодов

- [ ] Генерация уникальных ссылок
- [ ] Интеграция библиотеки для генерации QR-кодов
- [ ] Отображение QR-кода на странице
- [ ] Копирование ссылки в буфер обмена
- [ ] Генерация новой ссылки (инвалидация старой)

### 7.2. Управление сервером

- [ ] Кнопки запуска/остановки сервера
- [ ] Отображение статуса сервера
- [ ] Отображение адреса сервера
- [ ] Автоматический запуск сервера при генерации ссылки

**Результат:** Страница для управления мобильным доступом с QR-кодами

---

## Этап 8: Мобильный интерфейс

### 8.1. Адаптивный дизайн

- [ ] Создание мобильной версии компонентов
- [ ] Адаптивная верстка для различных размеров экранов
- [ ] Оптимизация для touch-управления
- [ ] Крупные кнопки для удобного использования

### 8.2. Функциональность мобильного интерфейса

- [ ] Отображение текущего счета
- [ ] Отображение текущей подачи
- [ ] Кнопки управления счетом
- [ ] Отображение счета по партиям
- [ ] Завершение партии
- [ ] Отмена последнего действия
- [ ] Индикатор синхронизации
- [ ] Упрощенный интерфейс без управления плашками vMix

### 8.3. Синхронизация данных

- [ ] Реал-тайм синхронизация с основным приложением
- [ ] Обработка конфликтов при одновременном изменении
- [ ] Отображение статуса синхронизации

**Результат:** Полнофункциональный мобильный интерфейс с синхронизацией

---

## Этап 9: Дополнительные страницы и функции

### 9.1. Страница "Добро пожаловать"

- [ ] Компонент главной страницы
- [ ] Кнопки создания/открытия матча
- [ ] Список последних матчей (опционально)
- [ ] Информация о статусе подключения

### 9.2. Навигация и меню

- [ ] Главное меню приложения
- [ ] Навигация между страницами
- [ ] Горячие клавиши
- [ ] Обработка закрытия приложения с несохраненными изменениями

### 9.3. О программе

- [ ] Страница с информацией о приложении
- [ ] Версия приложения
- [ ] Информация о лицензии

**Результат:** Полный набор страниц и функций приложения

---

## Этап 10: Тестирование и оптимизация

### 10.1. Тестирование функциональности

- [ ] Тестирование создания/открытия/сохранения матчей
- [ ] Тестирование ведения счета
- [ ] Тестирование интеграции с vMix
- [ ] Тестирование мобильного доступа
- [ ] Тестирование на различных устройствах

### 10.2. Обработка ошибок

- [ ] Обработка ошибок подключения к vMix
- [ ] Обработка ошибок работы с файлами
- [ ] Обработка ошибок сети
- [ ] Пользовательские сообщения об ошибках

### 10.3. Оптимизация

- [ ] Оптимизация производительности
- [ ] Оптимизация размера приложения
- [ ] Оптимизация сетевых запросов
- [ ] Кэширование данных

**Результат:** Протестированное и оптимизированное приложение

---

## Этап 11: Сборка и распространение

### 11.1. Настройка сборки

- [ ] Настройка electron-builder или electron-forge
- [ ] Создание иконок приложения
- [ ] Настройка конфигурации для разных платформ (Windows, macOS, Linux)

### 11.2. Создание установщиков

- [ ] Сборка для Windows (.exe)
- [ ] Сборка для macOS (.dmg)
- [ ] Сборка для Linux (.AppImage или .deb)

### 11.3. Документация

- [ ] Обновление README.md
- [ ] Создание руководства пользователя
- [ ] Документация API (если необходимо)

**Результат:** Готовое к распространению приложение

---

## Порядок приоритетов

### Минимально жизнеспособный продукт (MVP)

1. Этап 1 - Инициализация проекта
2. Этап 2 - Модель данных и управление файлами
3. Этап 3 - Основной интерфейс управления матчем
4. Этап 4 - Настройки матча
5. Этап 5 - Интеграция с vMix (базовая)
6. Этап 9.1 - Страница "Добро пожаловать"

### Полная версия

7. Этап 3.3 - Расширенная статистика
8. Этап 4.2 - Управление составами команд
9. Этап 5.4 - Управление плашками vMix
10. Этап 6 - Встроенный HTTP сервер
11. Этап 7 - Страница мобильного доступа
12. Этап 8 - Мобильный интерфейс
13. Этап 9 - Остальные страницы
14. Этап 10 - Тестирование и оптимизация
15. Этап 11 - Сборка и распространение

---

## Технические детали

### Зависимости проекта

- `electron` - фреймворк для десктопного приложения
- `react` - библиотека для UI
- `react-dom` - рендеринг React
- `react-router-dom` - маршрутизация
- `express` или встроенный `http` - HTTP сервер
- `qrcode` - генерация QR-кодов
- `axios` или `fetch` - HTTP клиент для vMix
- `electron-store` - хранение настроек (опционально)
- `sharp` или `jimp` - обработка изображений (логотипы)
- `uuid` - генерация уникальных идентификаторов

### Структура папок проекта

```
vmix-volley-scoreboard/
├── docs/                    # Документация
├── src/
│   ├── main/               # Основной процесс Electron
│   │   ├── main.js         # Точка входа
│   │   ├── server.js       # HTTP сервер
│   │   └── vmix-client.js  # Клиент vMix
│   ├── renderer/           # Рендер процесс
│   │   ├── index.html
│   │   ├── index.jsx
│   │   └── components/     # React компоненты
│   │   └── pages/          # Страницы приложения
│   └── shared/             # Общий код
│       └── types/          # TypeScript типы
├── matches/                # Папка для сохранения матчей
├── rosters/                # Папка для сохранения составов команд
├── logos/                  # Папка для сохранения логотипов
├── package.json
└── README.md
```

---

## Примечания

- На каждом этапе рекомендуется создавать коммиты в git
- Тестирование должно проводиться на каждом этапе
- При необходимости этапы можно выполнять параллельно
- Приоритет - простота и надежность, а не избыточная функциональность
