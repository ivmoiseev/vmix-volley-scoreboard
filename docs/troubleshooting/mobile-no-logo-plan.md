# План: корректная обработка отсутствия логотипов в мобильной версии

*Последнее обновление: 2026-02-12*

## Проблема

В мобильной панели управления счётом выводится блок с логотипами команд. Если логотипы в приложении **не заведены** (новый матч, логотипы не загружались), сценарий отрабатывается плохо:

1. **Текущее поведение**
   - В коде всегда подставляется fallback-URL: `/logos/logo_a.png` и `/logos/logo_b.png`, если у команды нет `logoPath`, `logoBase64` или `logo`.
   - Эти файлы в папке `logos/` часто **отсутствуют** (пользователь их не загружал).
   - Браузер запрашивает несуществующий ресурс → 404 → срабатывает `onerror` у `<img>`.
   - В `setLogoContainer` (domUtils) при `onerror` контейнер остаётся видимым (`display: flex`), но картинки нет → пользователь видит **пустые квадраты** (или иконку сломанного изображения в зависимости от браузера).
   - Нет явного состояния «логотипа нет»: ни скрытия блока, ни плейсхолдера.

2. **Итог**
   - Два пустых/битых блока вместо аккуратного отображения «без логотипов».
   - Возможные лишние 404-запросы к серверу.

## Цели

- При **отсутствии логотипов** в данных матча не показывать пустые/битые картинки.
- Либо скрывать блоки логотипов, либо показывать нейтральный плейсхолдер (инициалы команды или подпись «Нет логотипа»).
- При **ошибке загрузки** существующего URL (например, файл удалён с диска) тоже не оставлять пустой квадрат — скрывать контейнер или показывать плейсхолдер.

## Предлагаемый план исправления

### Шаг 1. Не использовать fallback-URL при отсутствии логотипа (обязательно)

**Файл:** `src/main/server.ts` (функция `getMobilePanelHTML`, блок `updateUI`).

**Сейчас:** в ветке `else` (нет logoPath / logoBase64 / logo) задаётся:
- `logoAUrl = \`http://.../logos/logo_a.png\``
- `logoBUrl = \`http://.../logos/logo_b.png\``

**Сделать:** в этой ветке присваивать `logoAUrl = null` и `logoBUrl = null`. Тогда `setLogoContainer(container, null, teamName)` уже скрывает контейнер (`container.style.display = 'none'`).

**Эффект:** если логотипы не заведены, блоки логотипов не отображаются, пустых квадратов и 404 по `logo_a.png`/`logo_b.png` не будет.

---

### Шаг 2. При ошибке загрузки изображения не оставлять пустой контейнер (обязательно)

**Файл:** `src/main/utils/domUtils.ts`, функция `setLogoContainer` (в коде, встраиваемом в HTML).

**Сейчас:** при `onerror` у `<img>` вызывается callback, который выставляет `container.style.display = 'flex'` — контейнер остаётся видимым, но без картинки.

**Сделать:** в `onerror` скрывать контейнер: `container.style.display = 'none'` (или удалять дочерние узлы и показывать плейсхолдер — см. шаг 3).

**Эффект:** если URL передан, но ресурс не загрузился (404, сеть, удалённый файл), пользователь не видит пустой квадрат.

---

### Шаг 3 (опционально). Плейсхолдер при отсутствии логотипа

**Вариант A — только скрытие (минимальные изменения)**  
После шагов 1–2 при отсутствии логотипа контейнер просто скрыт. Макет может «съехать» (место под логотипы пропадает). Для многих сценариев этого достаточно.

**Вариант B — плейсхолдер вместо логотипа**  
Когда логотипа нет (или не загрузился), не скрывать контейнер, а показывать внутри него:
- краткий текст, например «Нет логотипа» или «—»; или
- инициалы названия команды (например, первые буквы «К» и «С» для «Команда 1» и «Соперник»).

Тогда:
- В `server.ts` в ветке «нет логотипа» по-прежнему передавать в `setLogoContainer` что-то вроде `logoUrl = null` и, при необходимости, флаг/опцию «показать плейсхолдер».
- В `domUtils` расширить логику: при `logoUrl == null` и опции «плейсхолдер» — очистить контейнер, добавить в него текстовый узел (или span) с санитизированным текстом/инициалами, контейнер оставить видимым с тем же стилем (размер, фон), чтобы верстка не прыгала.

Вопрос к вам: нужен ли явный плейсхолдер (вариант B), или достаточно скрытия блоков (вариант A)?

---

### Шаг 4. Проверка API и данных матча (при необходимости)

- Убедиться, что в ответе API матча для мобильной панели при отсутствии логотипов не подставляются лишние поля (например, не отдаётся `logoPath: 'logos/logo_a.png'` по умолчанию). Сейчас в коде мобильной панели решение принимается по наличию `logoPath`/`logoBase64`/`logo` в объекте команды — этого достаточно, если в данных не подставляются дефолтные пути.
- При добавлении плейсхолдера (шаг 3B) можно при необходимости передавать в клиент флаг `hasLogo: false` для команды — не обязательно, если достаточно проверки по отсутствию URL.

---

## Порядок внедрения

1. **Сначала** — шаги 1 и 2 (убрать fallback-URL при отсутствии логотипа и скрывать контейнер при onerror). Это устраняет основную проблему.
2. **Затем** — при желании шаг 3 (плейсхолдер) и при необходимости шаг 4.

## Реализация (2026-02-12)

Принят вариант **A** — только скрытие блоков при отсутствии логотипов.

**Сделано:**
- **Шаг 1** (`src/main/server.ts`): при отсутствии logoPath/logoBase64/logo у команды в мобильной панели не подставляется fallback-URL; передаётся `null`, контейнер скрывается.
- **Шаг 2** (`src/main/utils/domUtils.ts`): при `onerror` загрузки изображения контейнер скрывается (`display: none`), а не остаётся пустым.
